<!DOCTYPE html>
<html>
  <head>
    <title>WebAR Animals</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    <style>
      body, html { margin: 0; overflow: hidden; }

    </style>
  </head>
  <body>
    <a-scene embedded arjs>
      <!-- 12 marker tanımı (içleri boş, modeller JS ile yüklenecek) -->
      <a-marker id="marker-elephant" type="pattern" url="markers/marker1-elephant.patt"></a-marker>
      <a-marker id="marker-lion"     type="pattern" url="markers/marker2-lion.patt"></a-marker>
      <a-marker id="marker-owl"      type="pattern" url="markers/marker3-owl.patt"></a-marker>
      <a-marker id="marker-cat"      type="pattern" url="markers/marker4-cat.patt"></a-marker>
      <a-marker id="marker-dog"      type="pattern" url="markers/marker5-dog.patt"></a-marker>
      <a-marker id="marker-wolf"     type="pattern" url="markers/marker6-wolf.patt"></a-marker>
      <a-marker id="marker-cow"      type="pattern" url="markers/marker7-cow.patt"></a-marker>
      <a-marker id="marker-bear"     type="pattern" url="markers/marker8-bear.patt"></a-marker>
      <a-marker id="marker-deer"     type="pattern" url="markers/marker9-deer.patt"></a-marker>
      <a-marker id="marker-horse"    type="pattern" url="markers/marker10-horse.patt"></a-marker>
      <a-marker id="marker-sheep"    type="pattern" url="markers/marker11-sheep.patt"></a-marker>
      <a-marker id="marker-bird"     type="pattern" url="markers/marker12-bird.patt"></a-marker>

      <a-entity camera>
        <a-entity cursor="rayOrigin: mouse" raycaster="objects: .clickable"></a-entity>
      </a-entity>
    </a-scene>

    <script>
      const animals = [
        { id: 'elephant', markerId: 'marker-elephant', modelUrl: 'models/model1-elephant.glb', scale: '1 1 1', rotation: '0 90 0', position: '0 0 0' },
        { id: 'lion',     markerId: 'marker-lion',     modelUrl: 'models/model2-lion.glb',     scale: '5 5 5', rotation: '0 0 0',  position: '0 1 0' },
        { id: 'owl',      markerId: 'marker-owl',      modelUrl: 'models/model3-owl.glb',      scale: '0.005 0.005 0.005', rotation: '15 135 -15', position: '0 0.8 -0.8' },
        { id: 'cat',      markerId: 'marker-cat',      modelUrl: 'models/model4-cat.glb',      scale: '10 10 10', rotation: '0 0 0', position: '0 0 0' },
        { id: 'dog',      markerId: 'marker-dog',      modelUrl: 'models/model5-dog.glb',      scale: '6 6 6', rotation: '0 0 0', position: '0 0 -4' },
        { id: 'wolf',     markerId: 'marker-wolf',     modelUrl: 'models/model6-wolf.glb',     scale: '0.6 0.6 0.6', rotation: '0 -90 0', position: '0 0 0' },
        { id: 'cow',      markerId: 'marker-cow',      modelUrl: 'models/model7-cow.glb',      scale: '2 2 2', rotation: '0 0 0', position: '0 0 0' },
        { id: 'bear',     markerId: 'marker-bear',     modelUrl: 'models/model8-bear.glb',     scale: '2 2 2', rotation: '0 0 0', position: '0 0 0' },
        { id: 'deer',     markerId: 'marker-deer',     modelUrl: 'models/model9-deer.glb',     scale: '2 2 2', rotation: '0 -90 0', position: '0 0 0' },
        { id: 'horse',    markerId: 'marker-horse',    modelUrl: 'models/model10-horse.glb',   scale: '2 2 2', rotation: '0 90 0', position: '0 0 0' },
        { id: 'sheep',    markerId: 'marker-sheep',    modelUrl: 'models/model11-sheep.glb',   scale: '0.6 0.6 0.6', rotation: '0 0 0', position: '0 0 0' },
        { id: 'bird',     markerId: 'marker-bird',     modelUrl: 'models/model12-bird.glb',    scale: '14 14 14', rotation: '0 0 0', position: '0 0 0' }
      ];

      let currentAudio = null;

      function playSound(animalId) {
        if (currentAudio) {
          currentAudio.pause();
          currentAudio.currentTime = 0;
        }
        currentAudio = new Audio(`sounds/${animalId}.mp3`);
        currentAudio.play().catch(err => {
          console.warn(`Ses oynatılamadı: ${animalId}`, err);
        });
      }

      animals.forEach(animal => {
        const marker = document.getElementById(animal.markerId);

        marker.addEventListener('markerFound', () => {
          if (!marker.querySelector('a-gltf-model')) {
            const model = document.createElement('a-gltf-model');
            model.setAttribute('src', animal.modelUrl);
            model.setAttribute('scale', animal.scale);
            model.setAttribute('rotation', animal.rotation);
            model.setAttribute('position', animal.position);

            // Basit tıklanabilir kutu
            const box = document.createElement('a-box');
            box.setAttribute('position', '0 1 0'); // İstenirse her hayvana özel ayarlanabilir
            box.setAttribute('width', '4');
            box.setAttribute('height', '4');
            box.setAttribute('depth', '4');
            box.setAttribute('material', 'opacity: 0; transparent: true');
            box.setAttribute('class', 'clickable');
            box.addEventListener('click', () => {
              if (marker.object3D.visible) {
                playSound(animal.id);
              }
            });

            const wrapper = document.createElement('a-entity');
            wrapper.appendChild(model);
            wrapper.appendChild(box);
            marker.appendChild(wrapper);
          }
        });

        marker.addEventListener('markerLost', () => {
          marker.innerHTML = ''; // Model DOM'dan tamamen temizlenir
        });
      });
    </script>
  </body>
</html>
